<h1 class="mb-4">作成済みプラン一覧</h1>

<% if @plans.present? %>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>プラン名</th>
          <th>受講者</th>
          <th>研修期間</th>
          <th>研修数</th>
          <th>研修内容</th>
        </tr>
      </thead>
      <tbody>
        <% @plans.each do |plan| %>
          <tr>
            <td>
              <strong>
                <%= link_to plan.name,
                  edit_admin_plan_path(plan),
                  class: "text-decoration-none" %>
              </strong>
            </td>
            <td><%= plan.participants %></td>
            <td>
              <% if plan.training_schedules.any? %>
                <% start_date = plan.training_schedules.minimum(:start_time) %>
                <% end_date = plan.training_schedules.maximum(:end_time) || plan.training_schedules.maximum(:start_time) %>
                <%= start_date.strftime("%m/%d") %> - <%= end_date.strftime("%m/%d") %>
                (<%= (end_date.to_date - start_date.to_date).to_i + 1 %>日間)
              <% else %>
                -
              <% end %>
            </td>
            <td><%= plan.training_schedules.count %></td>
            <td>
              <ul class="mb-0 ps-3">
                <% plan.training_schedules.order(:start_time).each do |schedule| %>
                <% st = schedule.start_time.strftime("%m/%d %H:%M") %>
                <% et = schedule.end_time ? schedule.end_time.strftime("%H:%M") : "" %>
                  <li>
                   <strong><%= st %></strong>
                    <% if et.present? %> - <strong><%= et %></strong><% end %>:
                    <%= link_to schedule.training.title, admin_training_schedule_path(schedule), class: "text-decoration-none" %>
                  </li>
                <% end %>
              </ul>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="alert alert-info">プランはまだ作成されていません。</div>
<% end %>

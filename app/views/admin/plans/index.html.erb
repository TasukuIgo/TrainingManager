<h1 class="mb-4">作成済みプラン一覧</h1>

<% if @plans.present? %>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>プラン名</th>
          <th>受講者</th>
          <th>研修期間</th>
          <th>研修数</th>
          <th>研修内容</th>
        </tr>
      </thead>
      <tbody>
        <% @plans.each do |plan| %>
          <tr>
            <td>
              <strong>
                <%= link_to plan.name,
                  edit_admin_plan_path(plan),
                  class: "text-decoration-none" %>
              </strong>
            </td>

            <td>
              <%= plan.participants.map(&:name).join(", ") %>
            </td>

            <td>
              <% if plan.start_date && plan.end_date %>
                <%= plan.start_date.strftime("%m/%d") %>
                -
                <%= plan.end_date.strftime("%m/%d") %>
                (<%= plan.training_days %>日間)
              <% else %>
                -
              <% end %>
            </td>

            <td><%= plan.training_schedules.count %></td>
            <td>
              <ul class="mb-0 ps-3">
                <% plan.training_schedules.order(:start_time).each do |schedule| %>
                <% st = schedule.start_time.strftime("%m/%d %H:%M") %>
                <% et = schedule.end_time ? schedule.end_time.strftime("%H:%M") : "" %>
                  <li>
                   <strong><%= st %></strong>
                    <% if et.present? %> - <strong><%= et %></strong><% end %>:
                    <%= link_to schedule.training.title, admin_training_schedule_path(schedule), class: "text-decoration-none" %>
                  </li>
                <% end %>
              </ul>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <div class="alert alert-info">プランはまだ作成されていません。</div>
<% end %>
